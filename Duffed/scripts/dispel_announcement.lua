if dStuff.dispelannouncement.enable ~= true then return end

-- Create movable frame for dispel announcements
local f = CreateFrame("MessageFrame", "dDispelFrame", UIParent)
f:SetPoint("TOP", 0, -220)
f:SetSize(200, 100)
f:SetFont(dStuff.font, dStuff.dispelannouncement.fontsize)
f:SetShadowOffset(1, -1)
f:SetShadowColor(0,0,0)
f:SetTimeVisible(2)
f:SetBackdrop({bgFile = "Interface\\ChatFrame\\ChatFrameBackground"})
f:SetBackdropColor(0,0,0,0)
f:SetMovable(true)
f:SetFrameStrata("HIGH")
f:SetInsertMode("TOP")
f:SetJustifyH(dStuff.dispelannouncement.justify)
f:SetClampedToScreen(true)
f:RegisterEvent("COMBAT_LOG_EVENT_UNFILTERED")

f:SetScript("OnEvent", function(self, event, ...)
	local timestamp, type, sourceGUID, sourceName, sourceFlags, destGUID, destName, destFlags = ...
	if (type == "SPELL_DISPEL" or type == "SPELL_STOLEN") and sourceName == UnitName("player") then
		f:AddMessage("- "..dStuff.dispelannouncement.textcolor..select(13, ...), 1, 1, 1)
	end
end)

-- slash command
local move = false
SLASH_DUFFEDDISPELLYEAH1 = "/ddispel"
SlashCmdList.DUFFEDDISPELLYEAH = function()
	if not move then
		move = true
		f:AddMessage("- "..dStuff.dispelannouncement.textcolor.."around!", 1, 1, 1)
		f:AddMessage("- "..dStuff.dispelannouncement.textcolor.."Dispelframe", 1, 1, 1)
		f:AddMessage("- "..dStuff.dispelannouncement.textcolor.."Move", 1, 1, 1)
		f:SetTimeVisible(999)
		f:EnableMouse(true)
		f:SetScript("OnMouseDown", function() f:StartMoving() end)
		f:SetScript("OnMouseUp", function() f:StopMovingOrSizing() end)
		f:SetBackdropColor(0.1, 0.1, 0.1, 0.6)
		print("|cffce3a19dStuff|r - Frame unlocked.")
	else
		f:SetTimeVisible(2)
		move = false
		f:EnableMouse(false)
		f:SetBackdropColor(0,0,0,0)
		print("|cffce3a19dStuff|r - Frame locked.")
	end
end